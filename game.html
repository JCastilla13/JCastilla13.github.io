<!DOCTYPE html>
<html>
<head>
<title>Jesus Castilla, página de ENTI (M04UF1). Portada</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Ubuntu+Condensed&family=Ubuntu:ital,wght@0,300;0,700;1,300&display=swap" rel="stylesheet">

<link rel="stylesheet" href="base.css" />
<link rel="stylesheet" href="game.css" />

<script>

	let game_data;
	
	let current_room = 0;
	let items_picked = [];
			
	function game (data) {
		game_data = data;
				
		terminalOut("<p><strong>¡Benvenido a ENTIerrame!</strong> El juego de terror definitivo.</p>");
		terminalOut("<p>Te encuentras en "+ data.rooms[current_room].name+". ¿Qué quieres hacer?</p>");
	}
		
	function terminalOut (info) {
	
		let terminal = document.getElementById("terminal");
				
		terminal.innerHTML += info;
		
		terminal.scrollTop = terminal.scrollHeight;
	}
	
	function getRoomNumber (room) {
				
		for (let i = 0; i < game_data.rooms.length; i++) {
			if (game_data.rooms[i].id == room) {
				return i;
			}
		}
				
		return -1;
	}
	
	function getDoorNumber (door) {
		
		for (let i = 0; i < game_data.doors.length; i++) {
			if (game_data.doors[i].id == door) {
				return i;
			}
		}
		return -1;
	}
	
	function getItemNumber (door) {
		
		for (let i = 0; i < game_data.items.length; i++) {
			if (game_data.items[i].id == item) {
				return i;
			}
		}
		return -1;
	}
	
	function parseCommand (command) {
	
	  console.log("El comando ", command);
	  
		switch (command) {
					
			case 'ver':
				terminalOut("<p>"+game_data.items[current_room].description+"</p>");
				
				break;
						
			case 'ir':
					
				let doors = "";
				let doors_num = game_data.rooms[current_room].doors.length;
						
				for (let i = 0; i < doors_num; i++) {
					doors += game_data.rooms[current_room].doors[i]+" ";
				}
						
				terminalOut("<p>Puedes ir a: "+doors+"</p>");
						
				break;
						
			case 'coger':
					
				break;
						
			default:
				terminalOut("<p><strong>ERROR:</strong> Comando <strong>"+command+"</strong> no encontrado</p>");
		}
	}
			
	function readAction () {
	
		let instruction = document.getElementById("commands").value;
		let instruction_trim = instruction.trim();

		let data = instruction_trim.split(" ");

		if (data.length == 0 || instruction_trim == ""){
			document.getElementById("terminal").innerHTML += "<p><strong>Error</strong>: escribe una instrucción</p>";
		return;
		}
		if (data.length == 1){
			parseCommand(data[0]);
		}
		else{
			parseInstruction(data);
		}
	}
			
			
	function parseInstruction (instruction) {
	
	  console.log("La instrucción", instruction);
	  
		switch (instruction[0]) {
					
			case 'ver':
			
					let item_num = getItemNumber(instruction[1]);	
					
					if (item_num < 0) {
					console.log("No hay items en este lugar");
					
					return;
				}
					
				break;
						
			case 'ir':
						
				let door_num = getDoorNumber(instruction[1]);
						
				if (door_num < 0) {
					console.log("Puerta errónea");
					return;
				}
						
				let room_num = getRoomNumber(game_data.doors[door_num].rooms[0]);
				let next_room = "";
						
				if (room_num == current_room) {
					current_room = getRoomNumber(game_data.doors[door_num].rooms[1]);
				}
				else {
					current_room = room_num;
				}
						
				next_room = game_data.rooms[current_room].name
						
				terminalOut("<p>Cambio de habitación a "+next_room+"</p>");
						
				break;
						
			case 'coger':
					
				break;
						
			default:
				terminalOut("<p><strong>ERROR:</strong> Comando <strong>"+instruction[0]+"</strong> no encontrado</p>");
		}
	}
		
fetch("https://jcastilla13.github.io/game.json").then(response => response.json()).then(data => game(data));



</script>
</head>
<body>

<header>
<h1>Jesus Castilla, página de ENTI (M04UF1)</h1>
<nav>
<ul id="main-menu">
<li id="menu-presentation"><a href="index.html">Presentación</a></li>
<li id="menu-hobbies"><a href="hobbies.html">Hobbies</a></li>
<li id="menu-contact"><a href="contact.html">Contacto</a></li>
<li id="menu-cv"><a href="cv.html">CV</a></li>
<li id="menu-game"><a href="game.html">Game</a></li>
</ul>
</nav>
</header>

<main>

<article>
<h2>Juegaco</h2>

<form>

<div id="terminal"></div>
<input type="text" id="commands" />
<input type="submit" value="Acción" onclick="readAction(); return false;" />

</form>

</article>

<aside>
<h2>Lateral</h2>
</aside>

</main>

<footer>
<p>Jesus Castilla (c) <span id="footer-year">2022</span></p>
<script>
 document.getElementById("footer-year").innerHTML = new Date().getFullYear();
 </script>
</footer>
</body>
</html>
